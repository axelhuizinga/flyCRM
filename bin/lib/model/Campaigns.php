<?php
/**
 * Generated by Haxe 3.4.0
 */

namespace model;

use \haxe\ds\StringMap;
use \php\Boot;
use \haxe\Log;
use \php\_Boot\HxString;
use \php\_Boot\HxAnon;

class Campaigns extends \Model {
	/**
	 * @var string
	 */
	public $campaign_id;


	/**
	 * @param StringMap $param
	 * 
	 * @return mixed
	 */
	static public function create ($param) {
		$self = new Campaigns();
		$self->table = "vicidial_campaigns";
		(Log::$trace)($param, new HxAnon([
			"fileName" => "Campaigns.hx",
			"lineNumber" => 22,
			"className" => "model.Campaigns",
			"methodName" => "create",
		]));
		return \Reflect::callMethod($self, \Reflect::field($self, ($param->data["action"] ?? null)), \Array_hx::wrap([$param]));
	}


	/**
	 * @param StringMap $param
	 * 
	 * @return void
	 */
	public function __construct ($param = null) {
		parent::__construct($param);
	}


	/**
	 * @param StringMap $q
	 * 
	 * @return mixed
	 */
	public function findLeads ($q) {
		$sb = new \StringBuf();
		$phValues = new \Array_hx();
		$fields = ($q->data["fields"] ?? null);
		$tmp = null;
		if ($fields !== null) {
			$tmp = $this->fieldFormat(HxString::split($fields, ",")->map(function ($f) {
				return \S::$my->real_escape_string($f);
			})->join(","));
		} else {
			$tmp = "*";
		}
		$sb->add("SELECT " . ($tmp??'null'));
		$sb->add(" FROM  `vicidial_list` WHERE `list_id` IN( SELECT `list_id` FROM vicidial_lists ");
		$where = ($q->data["where"] ?? null);
		if ($where !== null) {
			$this->buildCond($where, $sb, $phValues);
		}
		$sb->add(")");
		$order = ($q->data["order"] ?? null);
		if ($order !== null) {
			$this->buildOrder($order, $sb);
		}
		$limit = ($q->data["limit"] ?? null);
		$tmp1 = null;
		if ($limit === null) {
			$tmp1 = "15";
		} else {
			$tmp1 = $limit;
		}
		$this->buildLimit($tmp1, $sb);
		$this->data = new HxAnon([
			"rows" => $this->execute($sb->b, $phValues),
		]);
		return $this->json_encode();
	}
}


Boot::registerClass(Campaigns::class, 'model.Campaigns');
